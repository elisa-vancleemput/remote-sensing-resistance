---
bibliography: ../docs_carpentry/remote-sensing-resistance.bib
csl: ../docs_carpentry/ecology-letters.csl

params:
  title: Local forest structure variability increases resilience to wildfire in dry western U.S. coniferous forests
  author: |
    Michael J. Koontz^1,2,3\*^,
    Malcolm P. North^2,4^,
    Chhaya M. Werner^2,5,6^,
    Stephen E. Fick^7,8^,
    Andrew M. Latimer^2^
  affiliation: |
    ^1^Graduate Group in Ecology, University of California; Davis, CA, USA  
    ^2^Department of Plant Sciences, University of California; Davis, CA, USA  
    ^3^Earth Lab, University of Colorado-Boulder; Boulder, CO, USA  
    ^4^Pacific Southwest Research Station, USDA Forest Service; Mammoth Lakes, CA, USA  
    ^5^Center for Population Biology, University of California; Davis, CA, USA  
    ^6^German Centre for Integrative Biodiversity Research; Halle-Jena-Leipzig, Germany  
    ^7^US Geological Survey, Southwest Biological Science Center  
    ^8^Department of Ecology and Evolutionary Biology, University of Colorado; Boulder, CO, USA  
  running_title: |
    Remote sensing resistance
  keywords: |
    resilience, wildfire, severity, texture analysis, forest structure, Sierra Nevada, forest, disturbance
  correspondence: 4001 Discovery Drive; Boulder, CO 80303; michael.koontz@colorado.edu; (970) 682-4727
    
  date_generated: !r format(Sys.Date(), "%B %d, %Y")
  

geometry: margin=1in
header-includes:
  - \usepackage[left]{lineno}
  - \linenumbers
  - \usepackage{setspace}
  - \doublespacing
  - \DeclareUnicodeCharacter{200E}{}
  - \usepackage{caption}
  - \captionsetup[figure]{labelformat=empty}
  - \captionsetup[table]{labelformat=empty}
  
output: 
  pdf_document:
    keep_tex: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r dependencies}
library(here)
library(knitr)
library(kableExtra)
library(captioner)
library(tidyverse)
library(pander)

fig_nums <- captioner(prefix = "Fig. ")
table_nums <- captioner(prefix = "Tab. ")
eq_nums <- captioner(prefix = "Eq. ")
```

```{r source_analyses, results = "hide"}
cbi_models <- read_csv(here::here("analyses/analyses_output/cbi-calibration-model-comparison.csv"))

cbi_summary_stats_list <- read_rds(here::here("analyses/analyses_output/cbi-summary-stats-list.rds"))
total_conifer_cbi_plots <- cbi_summary_stats_list$total_conifer_cbi_plots

fire_perims_summary_stats_list <- read_rds(here::here("analyses/analyses_output/fire-perims-summary-stats-list.rds"))
frap_area_ypmc_burned <- fire_perims_summary_stats_list$frap_area_ypmc_burned
frap_fire_count_ypmc <- fire_perims_summary_stats_list$frap_fire_count_ypmc
r5_area_ypmc_burned <- fire_perims_summary_stats_list$r5_area_ypmc_burned
r5_fire_count_ypmc <- fire_perims_summary_stats_list$r5_fire_count_ypmc
total_conifer_samps <- fire_perims_summary_stats_list$total_conifer_samps

ci_betas <- read_csv(here::here("analyses/analyses_output/ci-betas.csv"))
ci_betas_print_table_simple <- read_csv(here::here("analyses/analyses_output/ci-betas-print-table-simple.csv"))

ic_print_table <- 
  read_csv(here::here("analyses/analyses_output/ic-print-table.csv")) %>% 
  dplyr::mutate(R2 = sprintf("%.3f", R2))

preFire_ndvi.neighborhood_mean_NDVI_correlation <- read_rds(here::here("analyses/analyses_output/preFire_ndvi.neighborhood_mean_NDVI_correlation.rds"))

print_cbi_models <- cbi_models
print_cbi_models[, 5:13] <- round(cbi_models[, 5:13], 3)
print_cbi_models <-
  print_cbi_models %>%
  arrange(desc(r2_kfold)) %>%
  mutate(rank = 1:nrow(.)) %>%
  dplyr::select(rank, response, time_window, interpolation, r2_kfold, a, b, c, low_sev, mod_sev, hi_sev)
```

# `r params$title`

`r params$author`

`r params$affiliation`

*^\*^Correspondence:* `r params$correspondence`

*Coauthor emails:* mnorth@ucdavis.edu (MPN), cwerner@ucdavis.edu (CMW), stephen.fick@gmail.com (SEF), amlatimer@ucdavis.edu (AML)
    
*Running title:* `r params$running_title`

*Keywords:* `r params$keywords`

*Type of article:* Letters

*Abstract word count:* 148  
*Main text word count:* 4994 (Intro: 1176; Methods: 1509; Results: 482; Discussion: 1827)  
*Text boxes word count:* 0

*Number of...* references: 111, figures: 5, tables: 1, text boxes: 0

*Statement of authorship:* MJK, CMW, SEF, MPN, and AML conceived the study. MJK, SEF, and CMW wrote the Earth Engine code. MJK performed the analysis, with input from all authors. MJK wrote the first draft of the manuscript. All authors contributed substantially to editing and revisions.

*Data accessibility statement:* The data and analysis code supporting the results are archived on the Open Science Framework at www.doi.org/10.17605/OSF.IO/27NSR.

*Date report generated:* `r params$date_generated`

# Abstract

A “resilient” forest endures disturbance and is likely to persist. Resilience to wildfire may arise from feedback between fire behavior and forest structure in dry forest systems. Frequent fire creates fine-scale variability in forest structure, which may then interrupt fuel continuity and prevent future fires from killing overstory trees. Testing the generality and scale of this phenomenon is challenging for vast, long-lived forest ecosystems. We quantify forest structural variability and fire severity across >30 years and >1,000 wildfires in California’s Sierra Nevada. We find that greater variability in forest structure increases resilience by reducing rates of fire-induced tree mortality and that the scale of this effect is local, manifesting at the smallest spatial extent of forest structure tested (90 x 90m). Resilience of these forests is likely compromised by structural homogenization from a century of fire suppression, but could be restored with management that increases forest structural variability.

# Introduction

Forests are essential components of the biosphere, and ensuring their persistence is of high management priority given their large carbon stores and other valued ecosystem services [@trumbore2015; @higuera2019]. Modern forests are subject to disturbances that are increasingly frequent, intense, and entangled with human society, which may compromise their resilience and their ability to persist [@millar2015; @seidl2016b; @schoennagel2017; @mcwethy2019; @hessburg2019]. A resilient forest can absorb disturbances and may reorganize, but is unlikely to transition to an alternate vegetation type in the long run [@holling1973; @walker2004]. Resilience can arise when interactions amongst heterogeneous elements within a system create stabilizing negative feedbacks, or interrupt positive feedbacks that would otherwise cause critical transitions [@peters2004; @reyer2015a]. System resilience can be generated by heterogeneity at a variety of organizational scales, including genetic diversity [@reusch2005], species diversity [@chesson2000], functional diversity [@gazol2016], topoclimatic complexity [@lenoir2013], and temporal environmental variation [@questad2008]. Forest resilience mechanisms are fundamentally difficult to quantify because forests comprise long-lived species, span large geographic extents, and are affected by disturbances at a broad range of spatial scales [@reyer2015; @reyer2015a]. It is therefore critical, but challenging, to understand the system-wide mechanisms underlying forest resilience and the extent to which humans have the capacity to influence them.

Wildfire severity describes a fire's effect on vegetation [@keeley2009] and high-severity fire, in which all or nearly all overstory vegetation is killed, can be a precursor to state transitions in dry coniferous forests [@stevens2017; @davis2019a]. For several centuries prior to Euroamerican invasion, fire regimes in this ecosystem were variable as a consequence of both natural and Indigenous burning, with primarily low- and moderate-severity fire and localized patches of high-severity fire [@safford2017]. Most dry coniferous tree species in frequent-fire forests did not evolve mechanisms to protect propagules (e.g., seeds, buds/stems that can resprout) from high-severity fire, so recruitment in large patches with few or no surviving trees is often limited by longer-distance dispersal of tree seeds from unburned or lower-severity areas [@welch2016; @stevens-rumann2019]. In the Sierra Nevada, the absence of tree seeds after severe wildfire can lead to forest regeneration failure as resprouting shrubs outcompete slower-growing conifer seedlings and provide continuous cover of flammable fuel that makes future high-severity wildfire more likely [@collins2013; @coppoletta2016], though this pathway doesn't materialize in forests with a slower postfire vegetation response [@prichard2014; @stevens-rumann2016a]. Dry forest regeneration is especially imperiled after high-severity fire when postfire climate conditions are suboptimal for conifer seedling establishment [@davis2019a] or optimal for shrub regeneration [@young2019]. 

Many dry western U.S. forests are experiencing "unhealthy" conditions which leaves them prone to catastrophic shifts in ecosystem type [@millar2015; @mcwethy2019]. First, a century of fire suppression has drastically increased forest density and fuel connectivity [@safford2017], which increases competition for water [@damato2013; @vanmantgem2016] and favors modern wildfires with large, contiguous patches of tree mortality whose interiors are far from potential seed sources [@miller2007; @stevens2017; @safford2017; @steel2018]. Second, warmer temperatures coupled with recurrent drought exacerbate water stress on trees [@parkwilliams2013; @millar2015; @clark2016], producing conditions favorable for high-intensity fire [@fried2004; @abatzoglou2016] and less suitable for postfire conifer establishment [@stevens-rumann2018; @davis2019a]. Thus, the presence of stabilizing feedbacks that limit high-severity fire may represent a fundamental resilience mechanism of dry coniferous forests, but anthropogenic climate and management impacts may be upsetting those feedbacks and eroding forest resilience.

Resilience to disturbances such as wildfire may derive from heterogeneity in vegetation structure [@turner1994a; @stephens2008; @north2009a; @virah-sawmy2009]. Forest structure-- the size and spatial distribution of vegetation in a forest-- links past and future fire disturbance via feedbacks with fire behavior [@agee1996]. A structurally variable forest with horizontally and vertically discontinuous fuel may experience slower-moving surface fires, a lower probability of crown fire initiation and spread, and a reduced potential for self-propagating, eruptive behavior [@scott2001; @graham2004; @peters2004; @fox2015; @parsons2017]. Feeding back to influence forest structure, this milder fire behavior, characteristic of pre-Euroamerican settlement conditions in dry western U.S. forests, generates a heterogeneous patchwork of fire effects including consumed understory vegetation, occasional overstory tree mortality, and highly variable structure at a fine scale [@sugihara2006; @scholl2010; @cansler2014; @safford2017]. Thus, more structurally variable dry forests are often considered more resilient and are predicted to persist in the face of frequent wildfire disturbance [@graham2004; @moritz2005; @stephens2008]. 

While the homogenizing effect of modern high-severity fire on forest structure is well-documented [@steel2018], the foundational concept of feedback between heterogeneity of forest structure and fire severity is underexplored at the ecosystem scale, in part because of the dual challenges of measuring fine-grain vegetation heterogeneity at broad spatial extents [@kane2015; @graham2019] and linking local, bottom-up processes to emergent ecosystem-wide patterns in an empirical setting [@turner1994a; @bessie1995; @mckenzie2011; @mckenzie2012]. Furthermore, it has been difficult to resolve the "scale of effect" [@graham2019] for how variability in forest structure is meaningful for resilience [@kotliar1990; @turner2013]. 

Advances in the accessibility and tractability of spatiotemporally extensive Earth observation data [@gorelick2017] provide an avenue to insight into fundamental ecosystem properties at relevant scales, such as resilience mechanisms of vast, long-lived forests. We use Landsat satellite imagery and a massively-parallel image processing approach to calculate wildfire severity for over 1,000 Sierra Nevada yellow pine/mixed-conifer wildfires encompassing a wide size range (4 to >100,000 hectares) and long time series (1984 to 2018). We calibrate these spectral severity measures to ground assessments of fire effects on overstory trees from 208 field plots. For each point within these ~1,000 fires, we use texture analysis [@haralick1973] at multiple scales to characterize local variability in vegetation structure across broad spatial extents and determine its "scale of effect" [@graham2019]. We pair the resulting extensive database of wildfire severity and multiple scales of local forest variability to ask: (1) Does spatial variability in forest structure increase the resilience of California yellow pine/mixed-conifer forests by reducing the severity of wildfires? (2) What is the "scale of effect" of structural variability that influences wildfire severity? and (3) Does the influence of structural variability on fire severity depend on topography, regional climate, or other conditions?

# Material and Methods

## Study system

```{r, results = "hide"}
fig_nums(name = "fig-study-geographic-setting")
```

![`r fig_nums(name = "fig-study-geographic-setting", display = "cite")`. Geographic setting of the study. A) Location of yellow pine/mixed-conifer forests as designated by the Fire Return Interval Departure (FRID) product which, among other things, describes the potential vegetation in an area based on the pre-Euroamerican settlement fire regime. B) Locations of all fires covering greater than 4 hectares that burned in yellow pine/mixed-conifer forest between 1984 and 2018 in the Sierra Nevada mountain range of California according to the State of California Fire Resource and Assessment Program database, the most comprehensive database of fire perimeters of its kind. Colors indicate how many fire perimeters overlapped a given pixel within the study time period. C) (red) Locations of `r total_conifer_cbi_plots` composite burn index (CBI) ground plots used to calibrate the remotely sensed measures of severity. (black) Locations of random samples drawn from `r frap_fire_count_ypmc` unique fires depicted in panel B that were in yellow pine/mixed-conifer forest as depicted in panel A, and which were designated as "burned" by exceeding a threshold relative burn ratio (RBR) determined by calibrating the algorithm presented in this study with ground-based CBI measurements.](../../figures/study-geographic-setting.pdf)

Our study assesses the effect of vegetation structure on wildfire severity in the Sierra Nevada mountain range of California in yellow pine/mixed-conifer forests (`r fig_nums(name = "fig-study-geographic-setting", display = "cite")`; Supp. methods). This system is dominated by a mixture of conifer species including ponderosa pine (*Pinus ponderosa* Lawson & C. Lawson), sugar pine (*Pinus lambertiana* Douglas), incense-cedar (*Calocedrus decurrens* (Torr.) Florin), Douglas-fir (*Pseudotsuga menziesii* (Mirb.) Franco), white fir (*Abies concolor* (Gord. & Glend.) Lindl. ex Hildebr.), and red fir (*Abies magnifica* A. Murray bis), angiosperm trees primarily including black oak (*Quercus kelloggii* Newberry), as well as shrubs (*Ceanothus* spp., *Arctostaphylos* spp.) [@safford2017]. 


## Programatically assessing wildfire severity

We measured forest vegetation characteristics and wildfire severity using imagery from the Landsat series of satellites post-processed to surface reflectance using radiometric corrections [@masek2006; @vermote2016; @usgs2018; @usgs2018a]. Landsat satellites image the entire Earth approximately every 16 days with a 30m pixel resolution. We used Google Earth Engine for image collation and processing [@gorelick2017].

We calculated wildfire severity for the most comprehensive record of fire perimeters in California: the Fire and Resource Assessment Program (FRAP) fire perimeter database (https://frap.fire.ca.gov/frap-projects/fire-perimeters/). The FRAP database includes all known fires that covered more than 4 hectares, compared to the regional standard database which includes fires covering greater than 80 hectares [@miller2012a; @steel2018] and the national standard database Monitoring Trends in Burn Severity (MTBS) which includes fires covering greater than 400 hectares in the western U.S. [@eidenshink2007]. Smaller fire events are important contributors to fire regimes, but their effects are often underrepresented in analyses of fire effects [@randerson2012]. The FRAP perimeters are error-checked, but it is possible that duplicated events are occasionally represented in the database. Using the FRAP database, we quantified fire severity within each perimeter of `r frap_fire_count_ypmc` wildfires in the Sierra Nevada yellow pine/mixed-conifer forest that burned between 1984 and 2018, which more than doubles the number of fire events with severity assessments compared to the regional standard database.

We created per-pixel median composites of collections of pre- and postfire images for each fire to calculate common spectral indices of wildfire severity. Prefire image collections spanned a fixed time window ending the day before each fire's discovery date and postfire image collections spanned the same fixed time window, exactly one year after the prefire window. We tested four different time periods (16, 32, 48, and 64 days) that defined the time window of the pre- and postfire image collections, and seven common spectral indices of severity (RBR, dNBR, RdNBR, dNBR2, RdNBR2, dNDVI, RdNDVI) for a total of 28 different means to remotely measure wildfire severity (Supp. methods).

We calibrated these 28 severity metrics with `r total_conifer_cbi_plots` field assessments of fire effects from previous studies [@zhu2006; @sikkink2013]. Severity was measured in the field as the overstory component of the Composite Burn Index (CBI)-- a metric of vegetation mortality across several vertical vegetation strata within a 30m diameter field plot. The overstory component of CBI characterizes fire effects to the overstory vegetation specifically, which includes both dominant/co-dominant big trees as well as intermediate-sized subcanopy trees (generally 10-25 cm DBH and 8-20m tall) [@key2006]. CBI ranges from 0 (no fire impacts) to 3 (very high fire impacts), and is a common standard for calibrating remotely-sensed severity data in western U.S. forests [@key2006; @miller2007; @miller2009a; @cansler2012; @parks2014a; @prichard2014; @parks2018]. We extracted each spectral severity metric at the CBI plot locations using both bilinear and bicubic interpolation [@cansler2012; @parks2014a; @parks2018] and fit a non-linear model: 

```{r eq-cbi-calibration, results = "hide"}
eq_nums(name = "eq-cbi-calibration")
```

(@eq-cbi-calibration) $\label{eq-cbi-calibration}
\text{remote\_severity} = \beta_0 + \beta_1 e^{\beta_2 \text{cbi\_overstory}}$

We treated the spectral severity measure as the dependent variable in this nonlinear regression for comparison with other studies [@miller2007; @miller2009a; @parks2014a]. We performed ten-fold cross validation using the `modelr` and `purrr` packages [@wickham2019; @henry2019] and report the average R^2^ value for each model. We used the severity calculation derived from the best fitting model for all further analyses (Relative Burn Ratio [RBR] calculated using a 48-day time window; ten-fold cross validation $R^2 =$ `r print_cbi_models$r2_kfold[1]`; first panel of `r fig_nums(name = "fig-cbi-calibration", display = "cite")`; Supp. Table 1).

```{r, results = "hide"}
fig_nums(name = "fig-cbi-calibration")
```

![`r fig_nums(name = "fig-cbi-calibration", display = "cite")`. Three top performing remotely-sensed severity metrics based on ten-fold cross validation (relative burn ratio, 48-day window, bicubic interpolation; relative delta normalized burn ratio, 32-day window, bilinear interpolation; and relative delta normalized difference vegetation index, 48-day window, bilinear interpolation) calculated using new automated image collation algorithms, calibrated to `r total_conifer_cbi_plots` field measures of fire severity (composite burn index). See Supplemental Table 1 for performance of all tested models.](../../figures/remote-sensed-severity-calibration.pdf) 


![`r fig_nums(name = "fig-pre-post-rbr", display = "cite")`. Example algorithm outputs for the Hamm Fire of 1987 (top half) and the American Fire of 2013 (bottom half) showing: prefire true color composite image (left third), postfire true color composite image (center third), relative burn ratio (RBR) calculation using a 48-day image collation window before the fire and one year later (right third). For visualization purposes, the continous severity index has been binned into severity categories.](../../figures/pre-post-rbr.pdf)

Using the non-linear relationship between RBR and CBI, we calculated the threshold RBR corresponding to "high-severity" signifying complete or near-complete overstory mortality using the common CBI high-severity lower threshold of 2.25 (i.e., an RBR value of `r print_cbi_models[1, "hi_sev"] %>% pull()`; `r fig_nums(name = "fig-pre-post-rbr", display = "cite")`) [@miller2007]. 

## Assessing local forest structure variability at broad extents

```{r, results = "hide"}
fig_nums(name = "fig-heterogeneity-raster")
```

We used texture analysis to calculate a remotely-sensed measure of local forest variability [@haralick1973; @tuanmu2015]. Within a moving square neighborhood window with sides of 90m (3x3 pixels), 150m (5x5 pixels), 210m (7x7 pixels), and 270m (9x9 pixels), we calculated forest variability for each pixel as the standard deviation of the NDVI values of its neighbors (not including itself). NDVI correlates well with foliar biomass, leaf area index, and vegetation cover [@rouse1973], so a higher standard deviation of NDVI within a given local neighborhood corresponds to discontinuous canopy cover and abrupt vegetation edges (see `r fig_nums(name = "fig-heterogeneity-raster", display = "cite")`) [@franklin1986]. 

![`r fig_nums(name = "fig-heterogeneity-raster", display = "cite")`. Example of homogenous forest (top row) and heterogenous forest (bottom row) with the same mean NDVI values (~0.6). Each column represents forest structural variability measured using a different neighborhood size. NDVI is represented by a white to green color gradient, and pixels that are not included in the forest structural variability metric are colored gray.](../../figures/heterogeneity-demo-raster.pdf)

## Assessing other conditions

Elevation data were sourced from a 1-arc second digital elevation model (DEM) [@farr2007] which was used to calculate slope, aspect, and potential annual heat load-- an integrated measure of latitude, slope, and aspect (@mccune2002; Supp. methods). Per-pixel topographic roughness was calculated as the standard deviation of elevation values within the same-sized kernels as those used for variability in forest structure  (90m, 150m, 210m, and 270m on a side and not including the central pixel). We chose this specific measure of topographic roughness because it directly parallels and accounts for our metric of forest structure variability and because of its use in other studies [@holden2009], though other measures of topographic heterogeneity have been used for fire modeling [@holden2009; @haire2009; @cansler2014].

We calculated prefire fuel moisture as the median 100-hour fuel moisture for the 3 days prior to the fire using gridMET, a gridded meteorological product with a daily temporal resolution and a 4km x 4km spatial resolution [@abatzoglou2013]. The 100-hour fuel moisture is a correlate of the regional temperature and moisture which integrates the relative humidity, the length of day, and the amount of precipitation in the previous 24 hours. Thus, this measure is sensitive to multiple hot dry days across the 4km x 4km spatial extent of each grid cell, but not to diurnal variation in relative humidity nor to extreme weather events during a fire.

## Modeling

Approximately 100 random points were selected within each FRAP fire perimeter in areas designated as yellow pine/mixed-conifer forest and we extracted the values of severity and covariate at those points using nearest neighbor interpolation. Using the calibration equation described in `r eq_nums(name = "eq-cbi-calibration", display = "cite")` for the best configuration of the remote severity metric, we removed sampled points corresponding to "unburned" area prior to analysis (i.e., below an RBR threshold of `r print_cbi_models[1, "low_sev"] %>% pull()`). The random sampling amounted to `r total_conifer_samps` total samples across `r frap_fire_count_ypmc` fires.

We used a hierarchical logistic regression model (`r eq_nums(name = "eq-severity-model", display = "cite")`) to assess the probability of high-severity wildfire as a linear combination of the remote metrics described above: prefire NDVI of each pixel, standard deviation of NDVI within a neighborhood (i.e., forest structural variability), the mean NDVI within a neighborhood, 100-hour fuel moisture, potential annual heat load, and topographic roughness. We included two-way interactions between the structural variability measure and prefire NDVI, neighborhood mean NDVI, and 100-hour fuel moisture. We include the two-way interaction between a pixel's prefire NDVI and its neighborhood mean NDVI to account for structural variability that may arise from contrasts between these variables (e.g., "holes in the forest" vs. "isolated patches"; Supp. Fig. 2). We scaled all predictor variables, used weakly-regularizing priors, and estimated an intercept for each individual fire with pooled variance (i.e., a group-level effect of fire). We used the `brms` package to fit models in a Bayesian framework which implements the No U-Turn Sampler extension to the Hamiltonian Monte Carlo algorithm [@hoffman2014; @burkner2017]. We used 4 chains with 5000 samples per chain (including 2500 warmup samples) and chain convergence was assessed for each estimated parameter by ensuring Rhat values were less than or equal to 1.01 [@burkner2017].

(@eq-severity-model)
$\begin{aligned}
\label{eq-severity-model}
se&verity_{i, j} \sim Bern(\phi_{i,j}) \\
lo&git(\phi_{i,j}) = \\
& \beta_0 + \\
& \beta_{\text{nbhd\_stdev\_NDVI}}X_{1,i} + \\
& \beta_{\text{prefire\_NDVI}}X_{2,i} + \\
& \beta_{\text{nbhd\_mean\_NDVI}}X_{3,i} + \\
& \beta_{\text{fm100}}X_{4,i} + \\
& \beta_{\text{pahl}}X_{5,i} + \\
& \beta_{\text{topographic\_roughness}}X_{6,i} + \\
& \beta_{\text{nbhd\_stdev\_NDVI*fm100}}X_{1,i}X_{4,i} + \\
& \beta_{\text{nbhd\_stdev\_NDVI*prefire\_NDVI}}X_{1,i}X_{2,i} + \\
& \beta_{\text{nbhd\_stdev\_NDVI*nbhd\_mean\_NDVI}}X_{1,i}X_{3,i} + \\
& \beta_{\text{nbhd\_mean\_NDVI*prefire\_NDVI}}X_{3,i}X_{2,i} + \\
& \gamma_j
\\
\gamma_j &\sim \mathcal{N}(0, \sigma_{\text{fire}})
\end{aligned}$

## Scale of effect of forest structure variability

Each neighborhood size (90m, 150m, 210m, 270m) was substituted in turn for the neighborhood standard deviation of NDVI, neighborhood mean NDVI, and terrain roughness covariates to generate a candidate set of 4 models. To assess the scale at which these neighborhood-size-dependent effects manifested, we compared the 4 candidate models using leave-one-out cross validation [@vehtari2017].  We inferred that the neighborhood size window used in the best-performing model reflected the scale at which the forest structure variability effect had the most support [@graham2019]. We used `R` for all statistical analyses [@rcoreteam2018]. 

# Results

Our programmatic assessment of wildfire severity calibrates as well or better than other reported methods that often require substantial manual intervention [@edwards2018]. We found that this approach was robust to a wide range of spectral severity metrics, time windows, and interpolation techniques, including those based on NDVI are seldom-used in this system (`r fig_nums(name = "fig-cbi-calibration", display = "cite")`; Supp. Tab. 1; Supp. methods).

```{r, results = "hide"}
table_nums(name = "table-ic-table", caption = "Comparison of four models described in Eq. \\ref{eq-severity-model} using different neighborhood sizes for calculating forest structural variability (standard deviation of NDVI within the neighborhood), neighborhood mean NDVI, and topographic roughness (standard deviation of elevation within the neighborhood). LOO is a measure of a model's predictive accuracy (with lower values corresponding to more accurate prediction) and is calculated as -2 times the expected log pointwise predictive density (elpd) for a new dataset [@vehtari2017]. $\\Delta$LOO is the difference between a model's LOO and the lowest LOO in a set of models (i.e., the model with the best predictive accuracy). The Bayesian $R^2$ is a 'data-based estimate of the proportion of variance explained for new data' [@gelman2019]. Note that Bayesian $R^2$ values are conditional on the model so shouldn't be compared across models, though they can be informative about a single model at a time.")
```

```{r ic_print_table, echo = FALSE, include = TRUE, results = 'asis'}
ic_print_table <-
  ic_print_table %>% 
  dplyr::rename(Model = model,
                `Neighborhood size for\nvariability measure` = neighborhood_size,
                `LOO\n(-2*elpd)` = loo,
                `$\\Delta$ LOO\nto best model` = delta,
                `SE of\n$\\Delta$ LOO` = se,
                `LOO model weight (%)` = loo_model_weights_pct,
                `Bayesian R^2^` = R2)

pandoc.table(ic_print_table, 
             split.tables = Inf,
             caption = table_nums(name = "table-ic-table"),
             keep.line.breaks = TRUE)
```

The model with the best out-of-sample prediction accuracy assessed by leave-one-out cross validation was the model fit using the smallest neighborhood size for the variability of forest structure (standard deviation of neighborhood NDVI), the mean of neighborhood NDVI, and the terrain roughness (standard deviation of elevation) (`r table_nums(name = "table-ic-table", display = "cite")`). One hundred percent of the model weight belongs to the model using the smallest neighborhood size window.

```{r, results = "hide"}
fig_nums(name = "fig-main-effects")
```

![`r fig_nums(name = "fig-main-effects", display = "cite")`. The main effects and 95% credible intervals of the covariates having the strongest relationships with the probability of high-severity fire. All depicted relationships derive from the model using the 90m x 90m neighborhood size window for neighborhood standard deviation of NDVI, neighborhood mean of NDVI, and topographic roughness, as this was the best performing model of the four neighborhood sizes tested. The effect sizes of these covariates were similar for each neighborhood size tested.](../../figures/prob-hi-sev-main-effects-credible-intervals.pdf)

We report the results from fitting the model described in `r eq_nums(name = "eq-severity-model", display = "cite")` using the smallest neighborhood size (90 x 90m) because this was the best performing model (see above) and because the size and magnitude of estimated coefficients were similar across neighborhood sizes (Supp. Tab. 2).

The strongest influence on the probability of a forested area burning at high-severity was the a pixel's prefire NDVI, with a greater prefire NDVI increasing the probability of high-severity fire ($\beta_{\text{prefire\_ndvi}}=$ `r round(ci_betas %>% filter(param == "b_preFire_ndvi" & radius == 1) %>% select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_preFire_ndvi" & radius == 1) %>% select(lwr, upr), 3)), collapse = ", ")`]); `r fig_nums(name = "fig-main-effects", display = "cite")`). There was a strong negative relationship between 100-hour fuel moisture and wildfire severity such that increasing 100-hour fuel moisture was associated with a decreasing probability of a high-severity wildfire ($\beta_{\text{fm100}}=$ `r round(ci_betas %>% filter(param == "b_fm100" & radius == 1) %>% select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_fm100" & radius == 1) %>% select(lwr, upr), 3)), collapse = ", ")`]) (`r fig_nums(name = "fig-main-effects", display = "cite")`). Potential annual heat load, which integrates aspect, slope, and latitude, also had a strong positive relationship with the probability of a high-severity fire. Areas that were located on southwest facing sloped terrain at lower latitudes had the highest potential annual heat load, and were more likely to burn at high-severity ($\beta_{\text{pahl}}=$ `r round(ci_betas %>% filter(param == "b_pahl" & radius == 1) %>% select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_pahl" & radius == 1) %>% select(lwr, upr), 3)), collapse = ", ")`]) `r fig_nums(name = "fig-main-effects", display = "cite")`). We found a negative effect of the prefire neighborhood mean NDVI on the probability of a pixel burning at high-severity ($\beta_{\text{nbhd\_mean\_NDVI}}=$ `r round(ci_betas %>% filter(param == "b_neighborhood_mean" & radius == 1) %>% select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_neighborhood_mean" & radius == 1) %>% select(lwr, upr), 3)), collapse = ", ")`]). This is in contrast to the positive effect of the prefire NDVI of the pixel itself. We found no effect of local topographic roughness on wildfire severity ($\beta_{\text{topographic\_roughness}}=$ `r round(ci_betas %>% filter(param == "b_topo_roughness" & radius == 1) %>% select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_topo_roughness" & radius == 1) %>% select(lwr, upr), 3)), collapse = ", ")`]).

There was also a strong negative interaction between the neighborhood mean NDVI and the prefire NDVI of the central pixel ($\beta_{\text{nbhd\_mean\_NDVI*prefire\_NDVI}}$ = `r round(ci_betas %>% filter(param == "b_neighborhood_mean_ndvi.preFire_ndvi" & radius == 1) %>% select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_neighborhood_mean_ndvi.preFire_ndvi" & radius == 1) %>% select(lwr, upr), 3)), collapse = ", ")`]). 

From the same model, we found strong evidence for a negative effect of variability of vegetation structure on the probability of a high-severity wildfire ($\beta_{\text{nbhd\_stdev\_NDVI}}=$ `r round(ci_betas %>% filter(param == "b_het" & radius == 1) %>% dplyr::select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_het" & radius == 1) %>% dplyr::select(lwr, upr), 3)), collapse = ", ")`]); `r fig_nums(name = "fig-main-effects", display = "cite")`). We also found significant interactions between variability of vegetation structure and prefire NDVI of the central pixel $\beta_{\text{nbhd\_stdev\_NDVI*prefire\_NDVI}}=$ `r round(ci_betas %>% filter(param == "b_het_ndvi.preFire_ndvi" & radius == 1) %>% dplyr::select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_het_ndvi.preFire_ndvi" & radius == 1) %>% dplyr::select(lwr, upr), 3)), collapse = ", ")`]) as well as between variability of vegetation structure and neighborhood mean NDVI ($\beta_{\text{nbhd\_stdev\_NDVI*nbhd\_mean\_NDVI}}=$ `r round(ci_betas %>% filter(param == "b_het_ndvi.neighborhood_mean_ndvi" & radius == 1) %>% dplyr::select(mean) %>% pull(), 3)`; 95% CI: [`r paste(as.character(round(ci_betas %>% filter(param == "b_het_ndvi.neighborhood_mean_ndvi" & radius == 1) %>% dplyr::select(lwr, upr), 3)), collapse = ", ")`]).

# Discussion

Broad-extent, fine-grain, spatially-explicit analyses of whole ecosystems are key to illuminating macroecological phenomena such as forest resilience to disturbance [@heffernan2014]. We used a powerful, cloud-based geographic information system and data repository, Google Earth Engine, as a 'macroscope' [@beck2012] to study feedbacks between vegetation structure and wildfire disturbance in yellow pine/mixed-conifer forests of California's Sierra Nevada mountain range. With this approach, we reveal and quantify general features of this forest system, and gain deeper insights into the mechanisms underlying its function.

## High-severity wildfire and ecological resilience

Wildfire severity can be considered a direct correlate of a forest's resistance-- the ease or difficulty with which a disturbance changes the system state [@walker2004; @folke2004]. One relevant state change for assessing ecosystem resistance is the loss of its characteristic native biota [@keith2013], which could be represented as overstory tree mortality (e.g., severity) in a forested system. The same fire behavior in two different forest systems (e.g., old-growth conifer versus young conifer plantation) may have very different abilities to cause overstory mortality [@keeley2009], which reflects differences in each forest's resistance.  Resistance is a key component of resilience [@walker2004; @folke2004] and, in this framework, one manifestation of forest resilience is high resistance to wildfire, whereby some mechanism leads to lower severity when a fire occurs. Here, we show clear evidence that structural heterogeneity fulfills this mechanistic resistance role in dry coniferous systems (`r fig_nums(name = "fig-main-effects", display = "cite")`). This study thus provides a particularly extensive, large-scale example of an association between local structural heterogeneity and ecosystem resilience, a phenomenon that has been demonstrated in other systems at smaller scales.

These findings do not imply that resistance to fire is a sole or necessary path to resilience. For instance, high-severity fire is characteristic of other forest systems such as serotinous lodgepole pine forests in Yellowstone National Park, and is not ordinarily expected to hamper forest regeneration [@turner1997]. Our inference that structural variability is a fundamental resilience mechanism in dry coniferous forests is strengthened by its large effect size and our ability to measure the negative feedback phenomenon at relevant spatiotemporal scales: we captured local-scale variability in structure and wildfire severity at broad spatial extents for an extensive set of over 1,000 fires across a 34-year time span.

## Factors influencing the probability of high-severity wildfire

We found that the strongest influence on the probability of high-severity wildfire was prefire NDVI. Greater NDVI corresponds to high canopy cover and vegetation density [@rouse1973] which translates directly to live fuel loads in the forest canopy and can increase high-severity fire [@parks2018]. Overstory canopy cover and density also correlate (though weakly) with surface fuel loads [@lydersen2015; @collins2016; @cansler2019], which can play a large role in driving high-severity fire in these forests [@agee1996]. Thus NDVI is likely a strong predictor of fire severity because it is correlated with both surface fuel loads and canopy live fuel density.

We found a strong positive effect of potential annual heat load as well as a strong negative effect of 100-hour fuel moisture, results which corroborates similar studies [@parks2018]. Some work has shown that terrain roughness [@holden2009; @haire2009; @dillon2011; @krawchuk2016] can be an important predictor of wildfire severity, but we found no effect using our measure of local terrain variability. This may be a function of scale-- our measures of topographic roughness were more localized than those of other studies [@holden2009; @dillon2011]. @haire2009 also found occasional instances where small differences in topographic roughness had dramatic differences in severity. These sorts of influences on severity would be challenging to detect in our modeling framework, which was designed to estimate an overall influence of topographic roughness on fire severity. Also, topographic roughness could be measured in different ways that highlight different types of heterogeneity [@haralick1973], which suggests that an effect of topographic roughness on mean wildfire severity will be best-captured by a roughness measure that aligns with the dominant phenomenon driving that effect. Finally, the observed influence of topographic roughness in other studies may have been fully or partially driven by variability in vegetation, which we partition separately in our study.

Critically, we found a strong negative effect of forest structural variability on wildfire severity that was opposite in direction but similar in magnitude to the effect of potential annual heat load. Just as the positive effect of NDVI is likely driven by increased fuel loads, the negative effect of variability in NDVI, is likely driven by discontinuity in surface, ladder, and canopy fuels, which can reduce the probability of initiation and spread of tree-killing crown fires [@wagner1977; @agee1996; @graham2004]. This discontinuity can manifest in a number of ways. For instance, neighboring forest pixels with different tree size distributions may disrupt a crown fire's spread from a low to a high crown or vice versa. Local NDVI variability may also reflect heterogeneous arrangement of vegetation types such as a forested pixel adjacent to a pixel mostly covered by grass. In the grass-dominated area, the relatively low flame heights would likely fail to initiate or sustain active crowning behavior that would kill overstory trees in the neighboring forested area. Finally, forest structural variability may also arise with different land cover types in the local neighborhood that influence severity, such as when exposed bedrock or a group of boulders acts as fire refugia for vegetation rooted within it [@hylander2010]. 

## Feedback between forest structural variability and wildfire severity

This system-wide inverse relationship between structural variability and wildfire severity closes a feedback that links past and future fire behavior via forest structure. Frequent wildfire in dry coniferous forests generates variable forest structure [@north2009a; @larson2012; @malone2018], which in turn, as we demonstrate, dampens the severity of future fire. In contrast, exclusion of wildfire homogenizes forest structure and increases the probability that a fire will produce large, contiguous patches of overstory mortality [@stevens2017; @steel2018]. The proportion and spatial configuration of fire severity in fire-prone forests are key determinants of their long-term persistence [@stevens2017; @steel2018]. Lower-severity fire or scattered patches of higher-severity fire reduce the risk of conversion to a non-forest vegetation type [@kemp2016; @stevens-rumann2018; @walker2018], while prospects for forest regeneration are bleaker when high-severity patch sizes are much larger than the natural range of variation for the system [@stevens2017; @miller2017; @stevens-rumann2019]. Thus, the forest-structure-mediated feedback between past and future fire severity underlies the resilience of the Sierra Nevada yellow pine/mixed-conifer system. 

## Scale of effect of variability in forest structure

We found that the effect of a forest patch's neighborhood characteristics on the probability of high-severity fire was strongest at the smallest neighborhood size that we tested, 90 x 90m. This suggests that the moderating effect of forest structure variability on fire severity is a very local phenomenon. This corroborates work by @safford2012, who found that crown fires (high tree-killing potential) were almost always reduced to surface fires (low tree-killing potential) within 70m of entering a fuel reduction treatment area.

Severity patterns at a landscape scale (e.g., for a whole fire) may represent cross-scale emergences of the local influence of forest structure variability on fire effects [@peters2004; @rose2017]. For instance, forest management actions (e.g., prescribed fire, use of wildfire under mild conditions) that reduce fuel loads and increase structural variability can be effective at reducing fire severity across broader spatial extents than the direct footprints of those actions [@graham2004; @stephens2009; @tubbesing2019]. Some work suggests that this sort of cross-scale emergence may depend on even broader-scale effects of fire weather, with small-scale variability failing to influence fire behavior under extreme conditions [@peters2004; @lydersen2014], though we did not detect such an interaction between our metric of burning conditions (100-hour fuel moisture) and forest structure variability. 

## Correlation between covariates and interactions

Unexpectedly, we found a strong interaction between the prefire NDVI at a pixel and its neighborhood mean NDVI on the probability of high-severity fire. These two variables are strongly correlated ($\text{Spearman's }\rho=$ `r round(preFire_ndvi.neighborhood_mean_NDVI_correlation, 3)`), so the general effect of this interaction is to dampen the dominating effect of prefire NDVI. Thus, though the marginal effect of prefire NDVI on the probability of high-severity fire is still positive and large, its real-world effect might be more comparable to other modeled covariates when including the negative main effect of neighborhood mean NDVI, the negative interaction effect of prefire NDVI and neighborhood mean NDVI, and their tendency to covary (compare the effect of prefire NDVI under the common scenario of prefire NDVI and neighborhood mean NDVI increasing or decreasing together: $\beta_{\text{prefire\_ndvi}}+\beta_{\text{nbhd\_mean\_NDVI}}+\beta_{\text{nbhd\_mean\_NDVI*prefire\_NDVI}}=$ `r round(ci_betas %>% filter(param == "b_preFire_ndvi" & radius == 1) %>% dplyr::select(mean) %>% pull() + ci_betas %>% filter(param == "b_neighborhood_mean" & radius == 1) %>% dplyr::select(mean) %>% pull() + ci_betas %>% filter(param == "b_neighborhood_mean_ndvi.preFire_ndvi" & radius == 1) %>% dplyr::select(mean) %>% pull(), 3)`, to the effect of 100-hour fuel moisture, which becomes the effect with the greatest magnitude: $\beta_{\text{fm100}}=$ `r round(ci_betas %>% filter(param == "b_fm100" & radius == 1) %>% dplyr::select(mean) %>% pull(), 3)`).

In the few cases when prefire NDVI and the neighborhood mean NDVI contrast, there is an overall effect of increasing the probability of high-severity fire. When prefire NDVI at the central pixel is high and the neighborhood NDVI is low (e.g., an isolated vegetation patch; Supplemental Fig. 2), the probability of high-severity fire is expected to dramatically increase. When prefire NDVI at the central pixel is low and the neighborhood NDVI is high (e.g., a hole in the forest; Supp. Fig. 2), the probability of high-severity fire at that central pixel is still expected to be fairly high even though vegetation is sparse there. In these forest NDVI datasets, when these variables do decouple, they tend to do so in the "hole in the forest" case and lead to a greater probability of high-severity fire at the central pixel despite its low NDVI. This can perhaps be explained if the consistently high vegetation density in a local neighborhood-- itself more likely to burn at high-severity-- exerts a contagious effect on the central pixel, raising its probability of burning at high-severity regardless of how much fuel might be there to burn. 

## Conclusions 

Theory and empirical work suggest a general link between forest structural heterogeneity and resilience. Here we find strong evidence with a large-scale study that, across large areas of forest, variable forest structure generally makes yellow pine/mixed-conifer forest in the Sierra Nevada more resistant to inevitable wildfire disturbance. It has been well-documented that frequent, low-severity wildfire maintains forest structural variability. Here, we demonstrate a system-wide reciprocal effect suggesting that greater local-scale variability of vegetation structure makes fire-prone, dry forests more resilient to wildfire and may increase the probability of their long-term persistence.

# Acknowledgements

We thank Connie Millar, Derek Young, and Meagan Oldfather for valuable comments about this work and we also thank the community of Google Earth Engine developers for prompt and helpful insights about the platform. We thank four anonymous reviewers for their helpful comments on the manuscript. Funding for this work was provided by NSF Graduate Research Fellowship Grant #DGE- 1321845 Amend. 3 as well as by Earth Lab through CU Boulder’s Grand Challenge Initiative and the Cooperative Institute for Research in Environmental Sciences (CIRES) at CU Boulder (to MJK).

# References

